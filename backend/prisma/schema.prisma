generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum QueueStatus {
  MENUNGGU
  IN_WH
  PROSES
  SELESAI
  BATAL
}

enum QueueCategory {
  RECEIVING
  DELIVERY
}

enum AdminRole {
  ADMIN
  WAREHOUSE
}

model QueueEntry {
  id              String        @id @default(uuid())
  customerId      String?
  customer        Customer?     @relation(fields: [customerId], references: [id], onDelete: Restrict)
  category        QueueCategory
  driverName      String
  truckNumber     String
  containerNumber String?
  registerTime    DateTime      @default(now())
  inWhTime        DateTime?
  startTime       DateTime?
  finishTime      DateTime?
  status          QueueStatus   @default(MENUNGGU)
  notes           String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  logs            QueueLog[]

  @@index([status, registerTime])
  @@index([truckNumber, registerTime])
  @@index([category, registerTime])
  @@index([customerId, registerTime])
}

model QueueLog {
  id           String       @id @default(uuid())
  queueEntryId String
  type         String       @map("action")
  fromStatus   QueueStatus? @map("oldStatus")
  toStatus     QueueStatus? @map("newStatus")
  userName     String
  actorUserId  String?
  createdAt    DateTime     @default(now())
  entry        QueueEntry   @relation(fields: [queueEntryId], references: [id], onDelete: Cascade)
  actorUser    AdminUser?   @relation(fields: [actorUserId], references: [id], onDelete: SetNull)

  @@index([queueEntryId, createdAt])
  @@index([actorUserId])
}

model Customer {
  id        String       @id @default(uuid())
  name      String
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  entries   QueueEntry[]

  @@index([name])
}

model AdminUser {
  id           String    @id @default(uuid())
  name         String
  position     String
  phone        String
  role         AdminRole
  username     String    @unique
  passwordHash String
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  logs         QueueLog[]

  @@index([role])
  @@index([username])
}
